# Release Images Metadata

Each release publishes an `images-metadata.yaml` artifact alongside `agents.tar.gz`.
This file summarizes base and agent metadata and is generated by
`scripts/generate-images-metadata.sh` during the release workflow.
`doc/validation/images-metadata.schema.json` defines the JSON Schema used to validate it.

## Contents

- `aicage-image.version`: The release tag of this repository.
- `aicage-image-base.version`: The latest release tag of `aicage-image-base` used
  to resolve `bases.tar.gz`.
- `bases`: Map of base alias to all key/values from `bases/<alias>/base.yaml`
  inside the base release artifact.
- `agent`: Map of agent name to all key/values from `agents/<agent>/agent.yaml`,
  plus a computed `valid_bases` map of base alias to image reference.

`valid_bases` is derived from the full base list and filtered by the optional
`base_exclude` and `base_distro_exclude` lists in each agent definition. Each
entry maps a base alias to the full image reference for the agent and base, for
example `ubuntu: ghcr.io/aicage/aicage:codex-ubuntu`.

`build_local` declares whether the agent must be built locally because the
license does not allow redistributing prebuilt images.

## Example

```yaml
aicage-image:
  version: 0.3.2
aicage-image-base:
  version: 0.9.1
bases:
  ubuntu:
    base_image_distro: Ubuntu
    base_image_description: Ubuntu base
    from_image: ubuntu:24.04
agent:
  copilot:
    agent_full_name: GitHub Copilot CLI
    agent_homepage: https://github.com/features/copilot/cli
    agent_path: ~/.copilot
    build_local: false
    base_exclude:
      - alpine
      - minimal
    base_distro_exclude:
      - Alpine
    valid_bases:
      ubuntu: ghcr.io/aicage/aicage:copilot-ubuntu
      debian: ghcr.io/aicage/aicage:copilot-debian
```
